<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Search: filters & group-by -->
    <record id="view_ojt_attendance_search" model="ir.ui.view">
        <field name="name">ojt.attendance.search</field>
        <field name="model">ojt.attendance</field>
        <field name="arch" type="xml">
            <search string="Search Attendance">
                <field name="batch_id"/>
                <field name="event_link_id"/>
                <field name="participant_id"/>

                <filter name="p_present" string="Present" domain="[('presence','=','present')]"/>
                <filter name="p_late" string="Late" domain="[('presence','=','late')]"/>
                <filter name="p_absent" string="Absent" domain="[('presence','=','absent')]"/>

                <filter name="m_qr" string="QR" domain="[('method','=','qr')]"/>
                <filter name="m_online" string="Online" domain="[('method','=','online')]"/>
                <filter name="m_manual" string="Manual" domain="[('method','=','manual')]"/>

                <filter name="today" string="Today"
                        domain="[('check_in','&gt;=', context_today().strftime('%%Y-%%m-%%d 00:00:00')),
                                 ('check_in','&lt;=', context_today().strftime('%%Y-%%m-%%d 23:59:59'))]"/>

                <group expand="0" string="Group By">
                    <filter name="g_batch" string="Batch" context="{'group_by':'batch_id'}"/>
                    <filter name="g_event" string="Event" context="{'group_by':'event_link_id'}"/>
                    <filter name="g_participant" string="Participant" context="{'group_by':'participant_id'}"/>
                    <filter name="g_presence" string="Presence" context="{'group_by':'presence'}"/>
                    <filter name="g_method" string="Method" context="{'group_by':'method'}"/>
                    <filter name="g_day" string="Day" context="{'group_by':'check_in:day'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- List: tabular attendance -->
    <record id="view_ojt_attendance_list" model="ir.ui.view">
        <field name="name">ojt.attendance.list</field>
        <field name="model">ojt.attendance</field>
        <field name="arch" type="xml">
            <list string="Attendance" default_order="check_in desc">
                <field name="batch_id"/>
                <field name="event_link_id"/>
                <field name="participant_id"/>
                <field name="check_in"/>
                <field name="check_out"/>
                <field name="presence"/>
                <field name="method"/>
                <field name="duration_minutes"/>
                <field name="attendance_percent"/>
            </list>
        </field>
    </record>

    <!-- Pivot: analytics by batch/event/participant -->
    <record id="view_ojt_attendance_pivot" model="ir.ui.view">
        <field name="name">ojt.attendance.pivot</field>
        <field name="model">ojt.attendance</field>
        <field name="arch" type="xml">
            <pivot string="Attendance Analytics" disable_linking="true">
                <field name="attendance_percent" type="measure"/>
                <field name="duration_minutes" type="measure"/>
                <field name="batch_id" type="row"/>
                <field name="event_link_id" type="row"/>
                <field name="participant_id" type="col"/>
            </pivot>
        </field>
    </record>

    <!-- Graph: attendance % per session -->
    <record id="view_ojt_attendance_graph" model="ir.ui.view">
        <field name="name">ojt.attendance.graph</field>
        <field name="model">ojt.attendance</field>
        <field name="arch" type="xml">
            <graph string="Attendance % per Session" type="bar">
                <field name="attendance_percent" type="measure"/>
                <field name="event_link_id" type="row"/>
            </graph>
        </field>
    </record>

    <!-- Form: quick actions, links, and details -->
    <record id="view_ojt_attendance_form" model="ir.ui.view">
        <field name="name">ojt.attendance.form</field>
        <field name="model">ojt.attendance</field>
        <field name="arch" type="xml">
            <form string="Attendance">
                <header>
                    <button name="action_check_in" type="object" string="Check In" class="oe_highlight"
                            invisible="check_in != False"/>
                    <button name="action_check_out" type="object" string="Check Out"
                            invisible="(check_in == False) or (check_out != False)"/>
                </header>

                <sheet>
                    <group col="2">
                        <group>
                            <field name="batch_id" required="1"/>
                            <field name="event_link_id" domain="[('batch_id', '=', batch_id)]"/>
                            <field name="participant_id" required="1" domain="[('batch_id', '=', batch_id)]"/>
                            <field name="presence"/>
                            <field name="method" readonly="1"/>
                        </group>
                        <group>
                            <field name="check_in"/>
                            <field name="check_out"/>
                            <field name="duration_minutes" readonly="1"/>
                            <field name="attendance_percent" readonly="1"/>
                        </group>
                    </group>

                    <group string="Links">
                        <field name="qr_token" readonly="1"/>
                        <field name="qr_url" readonly="1" widget="url"/>
                        <field name="join_url" readonly="1" widget="url"/>
                    </group>

                    <group>
                        <field name="notes"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

</odoo>
